#include <iostream>
#include <limits> // Required for numeric_limits

using namespace std;

/**
 * @brief Simple Calculator using a switch statement inside a continuous loop.
 * * The program prompts the user for two numbers and an operator, performs the calculation,
 * and then asks the user if they want to continue or exit.
 * Includes basic error handling for invalid operator, division by zero, and input stream failures.
 */
int main() {
    // Variable declarations
    char op;
    float num1, num2;
    float result = 0.0f;
    char choice;
    bool continue_loop;

    cout << "--- C++ Console Calculator ---" << endl;

    // Start of the main calculation loop
    do {
        // Reset flags for each new calculation
        bool calculation_successful = true;
        
        cout << "\n------------------------------" << endl;

        // 1. Get First Number
        cout << "Enter First number: ";
        if (!(cin >> num1)) {
            cerr << "Error: Invalid number input." << endl;
            calculation_successful = false;
        }

        // 2. Get Operator
        if (calculation_successful) {
            cout << "Enter operator (+, -, *, /): ";
            cin >> op;
            // No need to check for cin.fail() after char input unless EOF occurs.
        }

        // 3. Get Second Number
        if (calculation_successful) {
            cout << "Enter Second number: ";
            if (!(cin >> num2)) {
                cerr << "Error: Invalid number input." << endl;
                calculation_successful = false;
            }
        }

        // Clear input buffer for potential previous errors
        if (cin.fail()) {
            cin.clear();
            cin.ignore(numeric_limits<streamsize>::max(), '\n');
            calculation_successful = false;
        }

        // 4. Perform Calculation using switch case
        if (calculation_successful) {
            switch (op) {
                case '+':
                    result = num1 + num2;
                    break;
                case '-':
                    result = num1 - num2;
                    break;
                case '*':
                    result = num1 * num2;
                    break;
                case '/':
                    if (num2 != 0) {
                        result = num1 / num2;
                    } else {
                        cerr << "Error: Division by zero is not allowed." << endl;
                        calculation_successful = false;
                    }
                    break;
                default:
                    cerr << "Error: Invalid operator '" << op << "'. Please use +, -, *, or /" << endl;
                    calculation_successful = false;
            }
        }

        // 5. Display Result
        if (calculation_successful) {
            // Display the full expression and result
            cout << "Result: " << num1 << " " << op << " " << num2 << " = " << result << endl;
        }

        // 6. Ask to Continue or Exit
        do {
            cout << "\nDo you want to perform another calculation? (y/n): ";
            cin >> choice;
            // Clear input buffer just in case (e.g., user types 'yes' instead of 'y')
            cin.ignore(numeric_limits<streamsize>::max(), '\n');
            choice = tolower(choice); // Convert to lowercase for easy comparison
            
            if (choice != 'y' && choice != 'n') {
                cerr << "Invalid choice. Please enter 'y' for yes or 'n' for no." << endl;
            }

        } while (choice != 'y' && choice != 'n'); // Loop until valid choice is made

        continue_loop = (choice == 'y');

    } while (continue_loop); // Continue loop if user chose 'y'

    cout << "\nCalculator exited. Goodbye!" << endl;

    return 0;
}
